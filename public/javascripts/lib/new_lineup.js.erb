$(".modal-player-item").on('click', function(e){
    e.stopPropagation();
    const modalList = $(this).parent().parent().parent().parent();

    const blockId = modalList.attr('id').replace('modal-players-list','');
    const playerId = $(this).attr('id').replace('player','');
    const avatarContainer = $('#avatar-'+blockId);
    const kitContainer = $('#kit-'+blockId);
    const nameContainer = $('#name-'+blockId);
    const firstNameContainer = $('#first-name-'+blockId);
    const roundPlayerContainer = $('#round-player-'+blockId);
    const countryContainer = $('#country-'+blockId);
    const clubContainer = $('#club-'+blockId);
    const positionsContainer = $('#positions-'+blockId);

    $.ajax({
        type: "GET",
        dataType: "json",
        url: "/players/"+playerId,
        success: function(data){
            avatarContainer.attr("data", data.avatar_path);
            kitContainer.attr("data", data.kit_path);
            nameContainer.text(data.name);
            clubContainer.text(data.club_code);
            countryContainer.text(data.national_team_name);
            roundPlayerContainer.attr("value", playerId);

            if (data.first_name != null) {
                firstNameContainer.text(data.first_name);
            } else {
                firstNameContainer.text("");
            }

            positionsContainer.children(".team-player-position").hide();
            data.position_names.forEach((positionName) => {
                $('<div/>',{
                    text: positionName,
                    class: "team-player-position slot-position slot-position-" + positionName
                }).appendTo(positionsContainer);
                positionsContainer.append(' ')
            })
        }
    });

    $(modalList).hide();
});

$(document).ready(function() {
    const modal = document.getElementById("modules-modal");
    const btn = document.getElementById("modules-modal-btn");
    const span = document.getElementsByClassName("close")[0];

    btn.onclick = function() { modal.style.display = "block"; };
    span.onclick = function() { modal.style.display = "none"; };

    $('.player-data').click(function() {
        const btn = $(this);
        const playersList = btn.children(".modal-players-list")

        playersList.css("display", "block");

        const playerIds = [];
        $('.round-player-input').each(function() { playerIds.push($(this).val()); });
        const pickedPlayers = playerIds.filter(Boolean);

        playersList.find(".modal-player-item").each(function(innerIndex, innerElement) {
            if (pickedPlayers.includes(innerElement.id.replace("player", ""))) {
                innerElement.style.backgroundColor = "rgb(230, 230, 230)";
            }
        });
    });

    window.onclick = function(event) {
        if (event.target == modal) { modal.style.display = "none"; }

        if (event.target.className == "modal-players-list") {
            $('#' + event.target.id).css("display", "none");
        }
    }
});
